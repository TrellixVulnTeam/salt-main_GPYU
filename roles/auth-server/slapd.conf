{% set data = pillar['auth-server'] %}

# $OpenLDAP$
#
# See slapd.conf(5) for details on configuration options.
# This file should NOT be world readable.
#

# Define global ACLs to disable default read access.

# Do not enable referrals until AFTER you have a working directory
# service AND an understanding of referrals.
#referral	ldap://root.openldap.org

pidfile		/usr/local/var/slapd.pid
argsfile	/usr/local/var/slapd.args

#######################################################################
# sql database definitions
#######################################################################

database	sql
suffix		{{ data['suffix'] }}
rootdn		{{ data['admin-user'] }}
rootpw		{{ data['admin-password'] }}

dbhost		{{ data['db-host'] }}
dbname		{{ data['db-name'] }}
dbuser		{{ data['db-user'] }}
dbpasswd	{{ data['db-password'] }}

subtree_cond	"ldap_entries.dn LIKE CONCAT('%',?)"
insentry_stmt	"INSERT INTO ldap_entries (dn,oc_map_id,parent,keyval) VALUES (?,?,?,?)"
has_ldapinfo_dn_ru	no
